<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form action="/lobby" method="post">
      <h1>home</h1>
      <input type="submit" />
    </form>
    <div id="timer">Timer</div>
    <div id="lettre">Lettre</div>
    <table class="game">
      <thead>
        <tr>
          <th>Artiste</th>
          <th>Album</th>
          <th>Groupe de musique</th>
          <th>Instrument de musique</th>
          <th>Featuring</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" name="artiste" /></td>
          <td><input type="text" name="album" /></td>
          <td><input type="text" name="group" /></td>
          <td><input type="text" name="instru" /></td>
          <td><input type="text" name="feat" /></td>
          <td>
            <input type="button" value="Fini" onclick="end()" />
          </td>
        </tr>
      </tbody>
    </table>
    <div class="resul">
      <div class="artiste">
        <div class="prop">ici</div>
        <label>
          <input type="radio" name="artiste" value="vrai" />
          <span> Correct</span>
        </label>
        <label>
          <input type="radio" name="artiste" value="faux" />
          <span> Incorect </span>
        </label>
      </div>
      <div class="album">
        <div class="prop">ici</div>
        <label>
          <input type="radio" name="album" value="vrai" />
          <span> Correct</span>
        </label>
        <label>
          <input type="radio" name="album" value="faux" />
          <span> Incorect </span>
        </label>
      </div>
      <div class="group">
        <div class="prop">ici</div>
        <label>
          <input type="radio" name="group" value="vrai" />
          <span> Correct</span>
        </label>
        <label>
          <input type="radio" name="group" value="faux" />
          <span> Incorect </span>
        </label>
      </div>
      <div class="instru">
        <div class="prop">ici</div>
        <label>
          <input type="radio" name="instru" value="vrai" />
          <span> Correct</span>
        </label>
        <label>
          <input type="radio" name="instru" value="faux" />
          <span> Incorect </span>
        </label>
      </div>
      <div class="feat">
        <div class="prop">ici</div>
        <label>
          <input type="radio" name="feat" value="vrai" />
          <span> Correct</span>
        </label>
        <label>
          <input type="radio" name="feat" value="faux" />
          <span> Incorect </span>
        </label>
      </div>
    </div>
    <ul id="messageList"></ul>

    <script>
      const gameDiv = document.querySelector(".game");
      const resulDiv = document.querySelector(".resul");
      resulDiv.style.display = "none";
      var params = new URLSearchParams(window.location.search);
      var roomID = params.get("room");
      var ws = new WebSocket(
        "ws://10.70.6.24:8080/Scattergories/webs?room=" + roomID
      );
      ws.onmessage = function (event) {
        var data = JSON.parse(event.data);
        console.log(data);
        if (data.event == "fetchData") {
          collectAndSendValues();
        } else if (data.event == "timer") {
          var timer = document.getElementById("timer");
          timer.textContent = data.time;
        } else if (data.event == "letter") {
          resulDiv.style.display = "none";
          gameDiv.style.display = "block";
          var lettre = document.getElementById("lettre");
          lettre.textContent = data.lettre;
        } else if (data.event.includes("dataOf")) {
          var elemt = document.querySelectorAll(".prop");
          elemt.forEach(function (element) {
            resulDiv.style.display = "none";
            gameDiv.style.display = "block";
            if (element.parentNode.classList.contains("artiste")) {
              element.textContent = data.answer[0];
            }
            if (element.parentNode.classList.contains("album")) {
              element.textContent = data.answer[1];
            }
            if (element.parentNode.classList.contains("group")) {
              element.textContent = data.answer[2];
            }
            if (element.parentNode.classList.contains("instru")) {
              element.textContent = data.answer[3];
            }
            if (element.parentNode.classList.contains("feat")) {
              element.textContent = data.answer[4];
            }
          });
        }
      };

      function collectAndSendValues() {
        const dataToSend = {
          Event: "catchBackData",
          Data: [],
        };
        var inputs = document.querySelectorAll('input[type="text"]');
        inputs.forEach(function (input) {
          dataToSend.Data.push(input.value);
        });
        if (ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify(dataToSend));
        } else {
          console.error("WebSocket is not open.");
        }
      }
      function end() {
        var inputs = document.querySelectorAll('input[type="text"]');
        var lettre = document.getElementById("lettre");
        var good = true;
        inputs.forEach(function (input) {
          if (
            input.value.charAt(0).toLowerCase() !==
            lettre.textContent.toLowerCase()
          ) {
            good = false;
          }
        });
        const dataToSend = {
          Event: "end",
          Data: [],
        };
        if (good) {
          if (ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify(dataToSend));
          } else {
            console.error("WebSocket is not open.");
          }
        }
      }

      function scrore() {
        const radioButtons = document.querySelectorAll('input[type="radio"]');
        let score = 0;
        radioButtons.forEach((button) => {
          button.addEventListener("change", function () {
            if (this.value === "vrai") {
              score++;
      
            
            }
          });
        });
      }
    </script>
  </body>
</html>
